<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Realidad Aumentada — Oído</title>
  <link rel="stylesheet" href="css/styles.css"/>
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
</head>
<body>
  
<svg width="0" height="0" style="position:absolute">
  <defs>
    <linearGradient id="g-blue" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#60a5fa"/><stop offset="100%" stop-color="#3b82f6"/></linearGradient>
    <linearGradient id="g-green" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#34d399"/><stop offset="100%" stop-color="#10b981"/></linearGradient>
    <linearGradient id="g-orange" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#fbbf24"/><stop offset="100%" stop-color="#f59e0b"/></linearGradient>
    <linearGradient id="g-purple" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#c084fc"/><stop offset="100%" stop-color="#8b5cf6"/></linearGradient>
  </defs>
</svg>
<svg width="0" height="0" style="position:absolute">
  <symbol id="ico-home" viewBox="0 0 24 24"><path fill="url(#g-purple)" d="M12 3l9 8h-3v9h-5v-6h-2v6H6v-9H3l9-8z"/></symbol>
  <symbol id="ico-3d" viewBox="0 0 24 24"><path fill="url(#g-blue)" d="M12 2l9 5v10l-9 5-9-5V7l9-5zm0 2.2L5 7v8l7 3.8 7-3.8V7L12 4.2z"/></symbol>
  <symbol id="ico-info" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" fill="none" stroke="url(#g-green)" stroke-width="2"/><path fill="url(#g-green)" d="M11 10h2v7h-2zM11 6h2v2h-2z"/></symbol>
  <symbol id="ico-ar" viewBox="0 0 24 24"><path fill="url(#g-orange)" d="M12 2l7 4v12l-7 4-7-4V6l7-4zm0 2.2L7 6.5v7l5 2.8 5-2.8v-7L12 4.2z"/></symbol>
</svg>


  
<!-- v14: Figure icons (badge-like) -->
<svg width="0" height="0" style="position:absolute">
  <defs>
    <linearGradient id="bg-blue" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#93c5fd"/><stop offset="100%" stop-color="#3b82f6"/>
    </linearGradient>
    <linearGradient id="bg-green" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#6ee7b7"/><stop offset="100%" stop-color="#10b981"/>
    </linearGradient>
    <linearGradient id="bg-orange" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#fcd34d"/><stop offset="100%" stop-color="#f59e0b"/>
    </linearGradient>
    <linearGradient id="bg-purple" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#c4b5fd"/><stop offset="100%" stop-color="#8b5cf6"/>
    </linearGradient>
  </defs>
</svg>
<svg width="0" height="0" style="position:absolute">
  <!-- Home badge (house) -->
  <symbol id="fig-home" viewBox="0 0 64 64">
    <circle cx="32" cy="32" r="28" fill="url(#bg-purple)"/>
    <path d="M20 34v14h10V38h4v10h10V34h4L32 20 16 34h4z" fill="#fff" opacity="0.95"/>
  </symbol>
  <!-- 3D badge (cube) -->
  <symbol id="fig-3d" viewBox="0 0 64 64">
    <circle cx="32" cy="32" r="28" fill="url(#bg-blue)"/>
    <path d="M32 14l16 9v18l-16 9-16-9V23l16-9zm0 6l-10 5v10l10 5 10-5V25l-10-5z" fill="#fff" opacity="0.95"/>
  </symbol>
  <!-- Info badge (book/info) -->
  <symbol id="fig-info" viewBox="0 0 64 64">
    <circle cx="32" cy="32" r="28" fill="url(#bg-green)"/>
    <path d="M30 18h4v6h-4zM30 28h4v18h-4z" fill="#0b3" opacity="0.0"/>
    <path d="M32 16a16 16 0 1 0 .001 32.001A16 16 0 0 0 32 16zm-2 8h4v6h-4zm0 10h4v12h-4z" fill="#fff" opacity="0.95"/>
  </symbol>
  <!-- AR badge (phone/AR) -->
  <symbol id="fig-ar" viewBox="0 0 64 64">
    <circle cx="32" cy="32" r="28" fill="url(#bg-orange)"/>
    <rect x="20" y="18" width="24" height="28" rx="4" ry="4" fill="#fff" opacity="0.95"/>
    <path d="M26 24h12v4H26zM24 32h16v2H24zM24 36h16v2H24z" fill="#f59e0b"/>
  </symbol>
</svg>

  
<svg width="0" height="0" style="position:absolute">
  <defs>
    <linearGradient id="g-blue" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#60a5fa"/><stop offset="100%" stop-color="#3b82f6"/></linearGradient>
    <linearGradient id="g-green" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#34d399"/><stop offset="100%" stop-color="#10b981"/></linearGradient>
    <linearGradient id="g-orange" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#fbbf24"/><stop offset="100%" stop-color="#f59e0b"/></linearGradient>
    <linearGradient id="g-purple" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#c084fc"/><stop offset="100%" stop-color="#8b5cf6"/></linearGradient>
  </defs>
</svg>
<svg width="0" height="0" style="position:absolute">
  <symbol id="ico-home" viewBox="0 0 24 24"><path fill="url(#g-purple)" d="M12 3l9 8h-3v9h-5v-6h-2v6H6v-9H3l9-8z"/></symbol>
  <symbol id="ico-3d" viewBox="0 0 24 24"><path fill="url(#g-blue)" d="M12 2l9 5v10l-9 5-9-5V7l9-5zm0 2.2L5 7v8l7 3.8 7-3.8V7L12 4.2z"/></symbol>
  <symbol id="ico-info" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" fill="none" stroke="url(#g-green)" stroke-width="2"/><path fill="url(#g-green)" d="M11 10h2v7h-2zM11 6h2v2h-2z"/></symbol>
  <symbol id="ico-ar" viewBox="0 0 24 24"><path fill="url(#g-orange)" d="M12 2l7 4v12l-7 4-7-4V6l7-4zm0 2.2L7 6.5v7l5 2.8 5-2.8v-7L12 4.2z"/></symbol>
</svg>

  <div class="container">
    <header class="header">
      <div class="brand"><div class="logo"><svg viewBox="0 0 24 24"><use href="#fig-ar"/></svg></div><h1>Realidad Aumentada — Oído</h1></div>
      
      <nav class="actions">
        <a class="btn grad-purple" href="index.html"><svg class="ico-badge"><use href="#fig-home"/></svg> Inicio</a>
        <a class="btn grad-blue" href="scene-simple.html"><svg class="ico-badge"><use href="#fig-3d"/></svg> Vista 3D simple</a>
        <a class="btn grad-green" href="scene-info.html"><svg class="ico-badge"><use href="#fig-info"/></svg> 3D con información</a>
        <a class="btn grad-orange" href="ar.html"><svg class="ico-badge"><use href="#fig-ar"/></svg> Realidad Aumentada</a>
    
      </nav>
    
    </header>

    <section class="card">
      <mv-wrapper>
    <div class="ar-toolbar" id="arToolbar">
      <button class="ar-btn" id="arRotateL" title="Girar a la izquierda">
        <svg viewBox="0 0 24 24"><path fill="#93c5fd" d="M12 6v3l4-4-4-4v3A7 7 0 105 12H3a9 9 0 119 9v-2a7 7 0 100-13z"/></svg>
      </button>
      <button class="ar-btn" id="arRotateR" title="Girar a la derecha">
        <svg viewBox="0 0 24 24"><path fill="#93c5fd" d="M12 6v3l4-4-4-4v3a9 9 0 11-9 9h2a7 7 0 107-7z"/></svg>
      </button>
      <button class="ar-btn" id="arZoomIn" title="Aumentar tamaño">
        <svg viewBox="0 0 24 24"><path fill="#86efac" d="M11 6h2v5h5v2h-5v5h-2v-5H6v-2h5z"/></svg>
      </button>
      <button class="ar-btn" id="arZoomOut" title="Disminuir tamaño">
        <svg viewBox="0 0 24 24"><path fill="#fcd34d" d="M6 11h12v2H6z"/></svg>
      </button>
      <button class="ar-btn" id="arRecenter" title="Recolocar modelo">
        <svg viewBox="0 0 24 24"><path fill="#f0abfc" d="M12 5V3l-4 3 4 3V7a5 5 0 015 5h2a7 7 0 00-7-7zM5 12a7 7 0 007 7v2A9 9 0 013 12h2z"/></svg>
      </button>
      <button class="ar-btn" id="arHelpBtn" title="Ayuda / gestos"
      ></button>
      <button class="ar-btn primary" id="arPlaceOn" title="Colocar aquí (tocar piso)">
        <svg viewBox="0 0 24 24"><path fill="#60a5fa" d="M12 2l4 7h-3v6h-2V9H8l4-7z"/><ellipse cx="12" cy="19" rx="6" ry="2.5" fill="#60a5fa" opacity=".5"/></svg>
      </button>
      <button class="ar-btn success" id="arPlaceOff" title="Listo">
        <svg viewBox="0 0 24 24"><path fill="#34d399" d="M9 16.2l-3.5-3.5L4 14.2 9 19l11-11-1.5-1.5z"/></svg>
      </button>
      <button class="ar-btn" id="arHelpBtn" title="Ayuda / gestos">
        <svg viewBox="0 0 24 24"><path fill="#e879f9" d="M12 2a10 10 0 100 20 10 10 0 000-20zM11 10h2v7h-2zm0-4h2v2h-2z"/></svg>
      </button>
    </div>
    <div class="ar-help" id="arHelp">Gestos: rotar con 1 dedo • escalar con 2 dedos • mover con 2 dedos (según modo). En Android (Scene Viewer) y iOS (Quick Look) los gestos son nativos. Los botones funcionan en WebXR y vista previa.</div>
    
        <model-viewer src="assets/models/oido.glb" ios-src="assets/models/oido.usdz" ar ar-modes="webxr scene-viewer quick-look" ar-placement="floor" camera-controls touch-action="pan-y" ar-scale="fixed" shadow-intensity="0.5"></model-viewer>
      </mv-wrapper>
      <p class="legend">Android: Scene Viewer/WebXR. iOS: requiere USDZ para Quick Look (puedo convertir tu GLB a USDZ).</p>
    </section>

    <footer class="footer">
  <small>Proyecto desarrollado por <strong>Belén Acuña</strong> y <strong>Francisco Pinto</strong>. Uso exclusivamente educativo. <strong>Prohibida</strong> su reproducción, copia o distribución total o parcial sin autorización. © 2025</small>
</footer>
  </div>
  
<script>
(function(){
  const block = (e)=>{ e.preventDefault(); e.stopPropagation(); return false; };
  document.addEventListener('contextmenu', block, {capture:true});
  document.addEventListener('keydown', function(e){
    const k = e.key.toLowerCase();
    if (k === 'f12') return block(e);
    if (e.ctrlKey && e.shiftKey && ['i','j','c'].includes(k)) return block(e);
    if (e.ctrlKey && ['u','s','p'].includes(k)) return block(e);
  }, {capture:true});
})();
</script>


<script>
(function(){
  const mv = document.querySelector('model-viewer');
  const toolbar = document.getElementById('arToolbar');
  const help = document.getElementById('arHelp');
  let scale = 1.0;

  function isWebXR(){
    // model-viewer sets arStatus="session-started" in WebXR; Scene Viewer / Quick Look do not expose same
    return mv.ar && (mv.getAttribute('ar-modes') || '').includes('webxr');
  }
  function applyScale(val){
    scale = Math.min(3, Math.max(0.2, val));
    if (mv.model && mv.model.modelScene) {
      const s = scale;
      mv.model.modelScene.scale.set(s, s, s);
    } else if (mv.model) {
      // fallback
      const s = scale;
      mv.model.scale.set(s, s, s);
    }
  }
  function rotateBy(deltaDeg){
    if (mv.model) {
      const y = (mv.model.rotation.y || 0) + (deltaDeg * Math.PI/180);
      mv.model.rotation.y = y;
    }
  }
  document.getElementById('arRotateL').addEventListener('click', ()=> rotateBy(-10));
  document.getElementById('arRotateR').addEventListener('click', ()=> rotateBy(10));
  document.getElementById('arZoomIn').addEventListener('click', ()=> applyScale(scale*1.12));
  document.getElementById('arZoomOut').addEventListener('click', ()=> applyScale(scale/1.12));
  document.getElementById('arRecenter').addEventListener('click', ()=> {
    // Simple recenter: exit & re-enter AR if possible, else reset turntable
    if (mv.ar && mv.canActivateAR) {
      try{ mv.exitAR && mv.exitAR(); }catch(e){}
      setTimeout(()=> { try{ mv.activateAR && mv.activateAR(); }catch(e){} }, 200);
    } else {
      mv.resetTurntableRotation && mv.resetTurntableRotation();
      mv.cameraOrbit = 'auto auto auto';
    }
  });
  document.getElementById('arHelpBtn').addEventListener('click', ()=> help.classList.toggle('show'));

  // Toggle toolbar visibility depending on AR mode
  mv.addEventListener('ar-status', (ev)=>{
    const st = ev.detail.status || ev.target.getAttribute('ar-status');
    // Show toolbar in WebXR and preview; hide when delegating to native apps
    if (st === 'session-started') {
      toolbar.style.display = 'flex';
    } else if (st === 'not-presenting' || st === 'failed') {
      toolbar.style.display = 'flex';
    } else {
      // presenting in native mode
      toolbar.style.display = 'none';
      help.classList.remove('show');
    }
  });

  // Initialize scale after model loads
  mv.addEventListener('load', ()=> applyScale(1.0));
})();
</script>


<script>
// v18: placement mode using model-viewer's built-in ar-placement="interaction"
(function(){
  const mv = document.querySelector('model-viewer');
  const btnOn  = document.getElementById('arPlaceOn');
  const btnOff = document.getElementById('arPlaceOff');
  const toolbar = document.getElementById('arToolbar');
  let placing = false;

  function setPlacing(on){
    placing = on;
    if (placing){
      mv.setAttribute('ar-placement', 'interaction'); // shows reticle; tap to place
      btnOn.style.opacity = '1';
      btnOff.style.opacity = '1';
    } else {
      mv.setAttribute('ar-placement', 'floor'); // auto-lock to floor plane
      btnOn.style.opacity = '0.85';
      btnOff.style.opacity = '0.85';
    }
  }

  btnOn && btnOn.addEventListener('click', ()=> setPlacing(true));
  btnOff && btnOff.addEventListener('click', ()=> setPlacing(false));

  // When AR session starts, default to floor; show toolbar in WebXR; hide in native
  mv.addEventListener('ar-status', (ev)=>{
    const st = ev.detail.status || mv.getAttribute('ar-status');
    if (st === 'session-started'){
      // WebXR session
      toolbar.style.display = 'flex';
      setPlacing(false);
    } else if (st === 'not-presenting' || st === 'failed'){
      toolbar.style.display = 'flex';
      setPlacing(false);
    } else {
      toolbar.style.display = 'none'; // native app
    }
  });
})();
</script>


<script>
// v20: auto 'Colocar' on session start (WebXR) and switch to 'floor' after first tap.
// Approximate scale based on camera distance before AR (fallback if unsupported).
(function(){
  const mv = document.querySelector('model-viewer');
  const toolbar = document.getElementById('arToolbar');
  let firstTapDone = false;

  function setPlacement(mode){ mv && mv.setAttribute('ar-placement', mode); }

  function adjustScaleInitial(){
    try{
      const o = mv.getCameraOrbit(); // before entering AR
      const r = o && o.radius ? o.radius : 1.0;
      const targetScale = Math.min(2.0, Math.max(0.4, 0.9 / r));
      if (mv.model && mv.model.modelScene) {
        mv.model.modelScene.scale.set(targetScale, targetScale, targetScale);
      }
    }catch(e){}
  }

  mv.addEventListener('ar-status', (ev)=>{
    const st = ev.detail.status || mv.getAttribute('ar-status');
    if (st === 'session-started'){
      // Start in interaction mode -> user taps to place
      firstTapDone = false;
      setPlacement('interaction');
      toolbar && (toolbar.style.display = 'flex');
      adjustScaleInitial();
    }
  });

  mv.addEventListener('click', ()=>{
    // First tap after session start -> lock to floor
    if (!firstTapDone && mv.getAttribute('ar-placement') === 'interaction'){
      firstTapDone = true;
      setTimeout(()=> setPlacement('floor'), 200);
    }
  }, {passive:true});
})();
</script>

</body>
</html>
