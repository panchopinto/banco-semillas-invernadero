<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Banco de Semillas — Dashboard</title>
  <link rel="stylesheet" href="css/styles.css"/>
  <link rel="icon" href="img/seedling.svg" type="image/svg+xml"/>
  <script defer src="js/app.js"></script>
</head>
<body>
<header class="topbar">
  <div class="brand">
    <svg class="logo" viewBox="0 0 24 24" aria-hidden="true">
      <path d="M12 22c4-4 6-8 6-12a6 6 0 0 0-12 0c0 4 2 8 6 12z"></path>
      <circle cx="12" cy="7.2" r="1.6"></circle>
    </svg>
    <div>
      <h1>Banco de Semillas</h1><small class="subtitle">Invernadero — Liceo San Nicolás</small>
      <small id="today"></small>
    </div>
  </div>

  <div class="actions">
    <button class="tab green has-tip" id="btn-add" data-tip="Ingresar una nueva variedad de semilla"><svg viewBox="0 0 24 24" aria-hidden="true">
  <defs>
    <linearGradient id="g-seed" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0" stop-color="#a1ff7a"/><stop offset="1" stop-color="#22c55e"/>
    </linearGradient>
  </defs>
  <path fill="url(#g-seed)" d="M12 22c4-4 6-8 6-12a6 6 0 0 0-12 0c0 4 2 8 6 12z"/>
</svg><span class="label">Añadir semilla</span>
      <span class="icon">🌱</span> Añadir semilla
    </button>
    <button class="tab primary has-tip" id="btn-import" data-tip="Cargar semillas desde un archivo CSV (Google Sheets)"><svg viewBox="0 0 24 24">
  <defs><linearGradient id="g-import" x1="0" y1="0" x2="1" y2="1">
    <stop offset="0" stop-color="#4cc9f0"/><stop offset="1" stop-color="#705CFF"/></linearGradient></defs>
  <path fill="url(#g-import)" d="M5 20h14v-2H5v2zm7-16l-5 5h3v4h4v-4h3l-5-5z"/>
</svg><span class="label">Importar CSV</span>
      <span class="icon">📥</span> Importar CSV
    </button>
    <button class="tab orange has-tip" id="btn-export" data-tip="Descargar todas las semillas en formato CSV"><svg viewBox="0 0 24 24">
  <defs><linearGradient id="g-export" x1="0" y1="0" x2="1" y2="1">
    <stop offset="0" stop-color="#ffd166"/><stop offset="1" stop-color="#f59e0b"/></linearGradient></defs>
  <path fill="url(#g-export)" d="M19 12l-5-5v3H8v4h6v3l5-5zM5 20h14v-2H5v2z"/>
</svg><span class="label">Exportar CSV</span>
      <span class="icon">📤</span> Exportar CSV
    </button>
    <button class="tab has-tip" id="btn-calendar" data-tip="Ver resumen por mes de siembras recomendadas (6 meses)"><svg viewBox="0 0 24 24">
  <defs><linearGradient id="g-cal" x1="0" y1="0" x2="1" y2="1">
    <stop offset="0" stop-color="#a78bfa"/><stop offset="1" stop-color="#7c3aed"/></linearGradient></defs>
  <path fill="url(#g-cal)" d="M7 2h2v2h6V2h2v2h3v16H4V4h3V2zm12 6H5v10h14V8z"/>
</svg><span class="label">Calendario</span>
      <span class="icon">📅</span> Calendario de siembras
    </button>
    <button class="tab pink has-tip" id="btn-reset" data-tip="Reiniciar búsqueda y filtros"><svg viewBox="0 0 24 24">
  <defs><linearGradient id="g-broom" x1="0" y1="0" x2="1" y2="1">
    <stop offset="0" stop-color="#ff7eb6"/><stop offset="1" stop-color="#ff3d77"/></linearGradient></defs>
  <path fill="url(#g-broom)" d="M15 3l6 6-2 2-6-6 2-2zM3 21l6-2 7-7-4-4-7 7-2 6z"/>
</svg><span class="label">Limpiar filtros</span>
      <span class="icon">🧹</span> Limpiar filtro
    </button>
    <button class="tab has-tip" id="btn-theme" data-tip="Cambiar entre tema claro/oscuro"><svg viewBox="0 0 24 24">
  <defs><linearGradient id="g-theme" x1="0" y1="0" x2="1" y2="1">
    <stop offset="0" stop-color="#4cc9f0"/><stop offset="1" stop-color="#a1ff7a"/></linearGradient></defs>
  <path fill="url(#g-theme)" d="M12 3a9 9 0 106 15.9A9 9 0 0012 3z"/>
</svg><span class="label">Tema</span>
      <span class="icon">🌓</span> Tema
    </button>
    <input type="file" id="file-input" accept=".csv" hidden />
  </div>
</header>

<main>
  <section class="kpis">
    <div class="kpi card">
      <div class="kpi-label">Total variedades</div>
      <div class="kpi-value" id="kpi-total">0</div>
    </div>
    <div class="kpi card">
      <div class="kpi-label">Tipos (distribución)</div>
      <div class="kpi-value" id="kpi-tipos">—</div>
    </div>
    <div class="kpi card">
      <div class="kpi-label">Stock (sobres)</div>
      <div class="kpi-value" id="kpi-stock">0</div>
    </div>
    <div class="kpi card warn">
      <div class="kpi-label">Próximas a caducar</div>
      <div class="kpi-value" id="kpi-exp">0</div>
    </div>
  </section>

  <section class="filters card">
    <div class="row">
      <input id="q" class="input" placeholder="Buscar por nombre, científico, familia, notas…"/>
      <select id="f-tipo" class="select">
        <option value="">Tipo (todos)</option>
        <option>Hortaliza</option><option>Frutal</option><option>Hierba/Aromática</option>
        <option>Flor</option><option>Legumbre/Grano</option><option>Nativo</option>
      </select>
      <select id="f-familia" class="select">
        <option value="">Familia (todas)</option>
      </select>
      <select id="f-ciclo" class="select">
        <option value="">Ciclo (todos)</option>
        <option>Anual</option><option>Bianual</option><option>Perenne</option>
      </select>
      <select id="f-epoca" class="select">
        <option value="">Época actual</option>
        <option value="siembra">En época de siembra</option>
        <option value="transplante">En época de trasplante</option>
      </select>
      <button class="tab primary" id="btn-aplicar"><span class="icon i-play"></span><span class="label">Aplicar</span></button>
    </div>
    <div class="row wrap">
      <label class="chip"><input type="checkbox" id="c-invernadero"/> Invernadero</label>
      <label class="chip"><input type="checkbox" id="c-exterior"/> Exterior</label>
      <label class="chip"><input type="checkbox" id="c-pie"/> PIE (adaptado)</label>
      <label class="chip"><input type="checkbox" id="c-semilla-propia"/> Semilla propia</label>
      <label class="chip"><input type="checkbox" id="c-organica"/> Orgánica</label>
    </div>
  </section>

  <section class="grid">
    <aside class="card side">
      <h3>Resumen</h3>
      <canvas id="chartTipos" width="360" height="260" aria-label="Distribución por tipo"></canvas>
      <hr/>
      <h3>Calendario sugerido</h3>
      <div id="calendar" class="calendar"></div>
    </aside>

    <section class="card table">
      <div class="table-head">
        <div>Nombre común</div>
        <div>Nombre científico</div>
        <div>Familia</div>
        <div>Tipo</div>
        <div>Siembra</div>
        <div>Germinación</div>
        <div>Prof./Dist.</div>
        <div>Riego</div>
        <div>Ubicación</div>
        <div>Stock</div>
        <div>Responsable</div>
        <div>Acciones</div>
      </div>
      <div id="rows" class="table-rows"></div>
    </section>
  </section>
</main>

<footer>
  <div>Creado por: Francisco Pinto Aravena — franciscoandresp@gmail.com</div>
  <div>Este proyecto educativo apoya el PIE y la innovación en el invernadero.</div>
  <div>© <span class="year"></span> Todos los derechos reservados.</div>
</footer>

<!-- Modal -->
<dialog id="modal">
  <form id="form" method="dialog" class="modal card">
    <h3 id="modal-title">Nueva semilla</h3>
    <input type="hidden" id="id"/>
    <div class="grid-form">
      <label>Nombre común<input id="nombre" required/></label>
      <label>Nombre científico<input id="cientifico"/></label>
      <label>Familia<input id="familia"/></label>
      <label>Tipo
        <select id="tipo" required>
          <option>Hortaliza</option><option>Frutal</option><option>Hierba/Aromática</option>
          <option>Flor</option><option>Legumbre/Grano</option><option>Nativo</option>
        </select>
      </label>
      <label>Ciclo
        <select id="ciclo">
          <option>Anual</option><option>Bianual</option><option>Perenne</option>
        </select>
      </label>
      <label>Periodo de siembra (meses, ej: sep-oct, mar-abr)<input id="siembra"/></label>
      <label>Periodo de trasplante (opcional)<input id="trasplante"/></label>
      <label>Días germinación (ej: 7-14)<input id="germinacion"/></label>
      <label>Temp. germinación (°C)<input id="temp"/></label>
      <label>Profundidad siembra (cm)<input id="prof"/></label>
      <label>Distancia plantas (cm)<input id="dist"/></label>
      <label>Luz
        <select id="luz">
          <option>Sol</option><option>Semisombra</option><option>Sombra</option>
        </select>
      </label>
      <label>Riego
        <select id="riego">
          <option>Bajo</option><option>Medio</option><option>Alto</option>
        </select>
      </label>
      <label>Ubicación (estantería/caja)<input id="ubicacion"/></label>
      <label>Stock (sobres)<input id="stock" type="number" min="0" value="1"/></label>
      <label>Fecha recolección/lote<input id="lote"/></label>
      <label>Vida útil estimada (años)<input id="vida"/></label>
      <label>Responsable/Profesor<input id="responsable"/></label>
      <label>Curso/Proyecto<input id="curso"/></label>
      <label>Uso previsto (actividad)<input id="uso"/></label>
      <label>Compatibilidades/Asociaciones<input id="asocia" placeholder="zanahoria + cebolla…"/></label>
      <label>Alelopatías/No combinar<input id="anti" placeholder="no con…"/></label>
      <label>Plagas comunes<input id="plagas"/></label>
      <label>Recomendaciones<textarea id="reco" rows="2"></textarea></label>
      <label>Notas<textarea id="notas" rows="2"></textarea></label>
      <label class="check"><input type="checkbox" id="pie"/> Adaptaciones PIE</label>
      <label class="check"><input type="checkbox" id="organica"/> Semilla orgánica</label>
      <label class="check"><input type="checkbox" id="propia"/> Semilla propia</label>
    </div>
    <menu class="modal-actions">
      <button type="reset" class="tab has-tip" id="btn-cancel" data-tip="Cerrar sin guardar cambios">Cancelar</button>
      <button type="submit" class="tab green has-tip" id="btn-save" data-tip="Guardar la semilla en el banco">Guardar</button>
    </menu>
  </form>
</dialog>

<template id="row-tpl">
  <div class="row">
    <div class="cell nombre"></div>
    <div class="cell cientifico"></div>
    <div class="cell familia"></div>
    <div class="cell tipo"></div>
    <div class="cell siembra"></div>
    <div class="cell germ"></div>
    <div class="cell profdist"></div>
    <div class="cell riego"></div>
    <div class="cell ubicacion"></div>
    <div class="cell stock"></div>
    <div class="cell resp"></div>
    <div class="cell actions">
      <button class="icon-btn edit" title="Editar">✏️</button>
      <button class="icon-btn del" title="Eliminar">🗑️</button>
      <button class="icon-btn qr" title="QR detalle">🔗</button>
    </div>
  </div>
</template>

<script>
// fecha hoy (America/Santiago)
document.querySelector('.year').textContent = new Date().getFullYear();
const tz = Intl.DateTimeFormat().resolvedOptions().timeZone || "America/Santiago";
document.getElementById('today').textContent = new Date().toLocaleString('es-CL', { dateStyle:'full', timeStyle:'short' }) + " · " + tz;
</script>
</body>
</html>
