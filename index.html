<!DOCTYPE html>
<html lang="es">
<head>
  <meta name="bsi-build" content="f702a83337be"/>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Banco de Semillas ‚Äî Dashboard</title>
  <link rel="stylesheet" href="css/dashboard.css">
  <link rel="icon" href="img/logo_seedling.svg" type="image/svg+xml"/>
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <div class="logo"></div>
      <div>
        <h1>Banco de Semillas</h1>
        <p class="subtitle">Invernadero ‚Ä¢ Gesti√≥n y seguimiento</p>
      </div>
    </div>
    <div class="actions-right">
      <input id="search" type="search" placeholder="üîé Buscar por nombre, especie, etiqueta‚Ä¶" aria-label="Buscar" />
      <button class="btn ghost" id="refreshBtn" title="Actualizar desde CSV" aria-label="Actualizar">‚Üª</button>
    </div>
  </header>

  <nav class="tabs">
    <button class="tab active" data-view="inventario"><span class="ico ico-seed"></span> Inventario</button>
    <button class="tab" data-view="calendario"><span class="ico ico-calendar"></span> Calendario</button>
    <button class="tab" data-view="reportes"><span class="ico ico-report"></span> Reportes</button>
    <button class="tab" data-view="config"><span class="ico ico-settings"></span> Configuraci√≥n</button>
  </nav>

  <main>
    <!-- KPIs -->
    <section class="kpis" id="kpis">
      <div class="kpi grad-green">
        <div class="kpi-icon">üì¶</div>
        <div class="kpi-body">
          <div class="kpi-title">Variedades</div>
          <div class="kpi-value" id="kpi-variedades">‚Äî</div>
        </div>
      </div>
      <div class="kpi grad-blue">
        <div class="kpi-icon">üìä</div>
        <div class="kpi-body">
          <div class="kpi-title">Stock total</div>
          <div class="kpi-value" id="kpi-stock">‚Äî</div>
        </div>
      </div>
      <div class="kpi grad-orange">
        <div class="kpi-icon">‚è≥</div>
        <div class="kpi-body">
          <div class="kpi-title">Pr√≥x. a caducar</div>
          <div class="kpi-value" id="kpi-caducar">‚Äî</div>
        </div>
      </div>
    </section>

    <!-- Inventario -->
    <section class="view active" id="view-inventario">
      <div class="toolbar">
        <div class="left">
          <button class="btn grad-green" id="addSeedBtn">‚ûï A√±adir</button>
          <input id="filePicker" type="file" accept=".csv,text/csv" hidden>
          <button class="btn grad-blue" id="importBtn">üì• Importar CSV</button>
          <button class="btn grad-orange" id="exportBtn">üì§ Exportar</button>
          <button class="btn grad-purple" id="toggleViewBtn">üß≠ Tabla</button>
        </div>
        <div class="right">
          <div class="filters">
            <select id="filterTipo" aria-label="Filtrar por tipo">
              <option value="">Tipo</option>
              <option>Hoja</option><option>Fruto</option><option>Flor</option><option>Ra√≠z</option><option>Bulbo</option>
            </select>
            <select id="filterCiclo" aria-label="Filtrar por ciclo">
              <option value="">Ciclo</option>
              <option>Anual</option><option>Bianual</option><option>Perenne</option>
            </select>
            <select id="filterEpoca" aria-label="Filtrar por √©poca siembra">
              <option value="">√âpoca</option>
              <option>Primavera</option><option>Verano</option><option>Oto√±o</option><option>Invierno</option>
            </select>
            <select id="filterEtiqueta" aria-label="Filtrar por etiqueta">
              <option value="">Etiqueta</option>
              <option>PIE</option><option>org√°nica</option><option>semilla propia</option>
            </select>
            <button class="btn ghost" id="clearFilters">‚ôªÔ∏è Limpiar</button>
          </div>
        </div>
      </div>

      <div id="seed-count" class="count"></div>

      <!-- Grid cards -->
      <div id="seed-grid" class="grid"></div>
      <div id="empty" class="empty hidden">Sin resultados para tu b√∫squeda / filtros.</div>

      <!-- Table view -->
      <div id="tableWrap" class="hidden">
        <table class="table" id="seed-table" aria-label="Tabla de semillas">
          <thead>
            <tr>
              <th>QR</th>
              <th>Nombre</th>
              <th>Cient√≠fico</th>
              <th>Tipo</th>
              <th>Periodos</th>
              <th>Germinaci√≥n</th>
              <th>Prof./Dist.</th>
              <th>Riego</th>
              <th>Ubicaci√≥n</th>
              <th>Stock</th>
              <th>Responsable</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- Calendario -->
    <section class="view" id="view-calendario">
      <div class="calendar card">
        <div class="cal-header">
          <h2>üìÖ Siembras sugeridas ‚Äî pr√≥ximos 6 meses</h2>
        </div>
        <div id="calGrid" class="grid-6"></div>
      </div>
    </section>

    <!-- Reportes -->
    <section class="view" id="view-reportes">
      <div class="card">
        <h2>üìä Reportes</h2>
        <p>Exporta CSV del inventario actual o imprime la vista.</p>
        <div id="stickyActions" class="actions sticky-actions">
          <button class="btn grad-purple" id="downloadCSV">üì§ Exportar CSV</button>
          <button class="btn grad-pink" id="printView">üñ®Ô∏è Imprimir</button>
        </div>
      </div>
    </section>

    <!-- Config -->
    <section class="view" id="view-config">
      <div class="card">
        <h2>‚öôÔ∏è Configuraci√≥n</h2>
        <p>Reemplaza la URL del CSV por tu Google Sheets publicado:</p>
        <pre class="code">const CSV_URL = "data/seeds.csv";</pre>
        <label><input type="checkbox" id="readonlyToggle"> Modo solo lectura</label>
      </div>
    </section>
  
  <!-- Editor de Semilla -->
  <div id="seedEditorModal" style="position:fixed; inset:0; display:none; background:rgba(0,0,0,.55); z-index:9999;">
    <div style="max-width:720px; margin:6vh auto; background:#101010; border:1px solid #2a2a2a; border-radius:16px; padding:16px;">
      <h2 id="edTitle">Editar semilla</h2>
      <div class="grid2" style="display:grid; grid-template-columns:1fr 1fr; gap:.75rem;">
        <label>Nombre<input id="ed_name" type="text"/></label>
        <label>Especie<input id="ed_species" type="text"/></label>
        <label>Tipo<input id="ed_type" type="text"/></label>
        <label>Ciclo<input id="ed_cycle" type="text"/></label>
        <label>Per√≠odo siembra<input id="ed_sow" type="text"/></label>
        <label>Per√≠odo trasplante<input id="ed_trans" type="text"/></label>
        <label>Germinaci√≥n m√≠n (d√≠as)<input id="ed_gmin" type="number" min="0"/></label>
        <label>Germinaci√≥n m√°x (d√≠as)<input id="ed_gmax" type="number" min="0"/></label>
        <label>Profundidad<input id="ed_depth" type="text"/></label>
        <label>Distancia<input id="ed_spacing" type="text"/></label>
        <label>Riego<input id="ed_watering" type="text"/></label>
        <label>Ubicaci√≥n<input id="ed_location" type="text"/></label>
        <label>Stock<input id="ed_stock" type="number" min="0"/></label>
        <label>Responsable<input id="ed_resp" type="text"/></label>
        <label>Curso/Proyecto<input id="ed_curso" type="text"/></label>
        <label>Uso previsto<input id="ed_uso" type="text"/></label>
        <label>Interior<input id="ed_indoor" type="checkbox"/></label>
        <label>Exterior<input id="ed_outdoor" type="checkbox"/></label>
        <label>Etiquetas (separadas por coma)<input id="ed_tags" type="text"/></label>
      </div>
      <div style="display:flex; justify-content:flex-end; gap:.5rem; margin-top:1rem;">
        <button id="ed_cancel" class="btn">Cancelar</button>
        <button id="ed_save" class="btn" data-guard="editor">Guardar cambios</button>
      </div>
      <p class="muted" style="margin-top:.5rem;">Los cambios se guardan localmente (overlay). No modifican el CSV original.</p>
    </div>
  </div>

</main>

  <footer class="site-footer">
    <p>Creado por: <strong>Francisco Pinto Aravena</strong> ‚Äî <a href="mailto:franciscoandresp@gmail.com">franciscoandresp@gmail.com</a><br/>
    ¬© Queda prohibida la copia, redistribuci√≥n o adaptaci√≥n sin autorizaci√≥n.<br/>
    ¬© Todos los derechos reservados.</p>
  </footer>



  <!-- Drawer detalle -->
  <aside id="detailDrawer" aria-hidden="true">
    <div class="drawer">
      <header>
        <h3 id="detailTitle">Ficha de semilla</h3>
        <button id="closeDrawer" class="btn ghost">Cerrar</button>
      </header>
      <div id="detailBody" class="drawer-body"></div>
    </div>
  </aside>

  <!-- Modal A√±adir/Editar -->
  <dialog id="seedModal">
    <form method="dialog" class="modal" id="seedForm" novalidate>
      <header class="modal-header drag-handle"><h3 id="modalTitle">‚ûï Semilla</h3></header>
      <div class="modal-toolbar" role="toolbar">
        <button type="button" id="btnModalAccept" class="btn grad-green small upper left-btn">‚úÖ ACCEDER</button>
        <button type="button" id="btnModalCancel" class="btn grad-orange small upper right-btn">‚úñÔ∏è CANCELAR</button>
      </div>
      <div class="modal-scroll grid-2">
        <label>Nombre<input required name="name" /></label>
        <label>Especie<input name="species" /></label>
        <label>Tipo<select name="type"><option></option><option>Hoja</option><option>Fruto</option><option>Flor</option><option>Ra√≠z</option><option>Bulbo</option></select></label>
        <label>Ciclo<select name="cycle"><option></option><option>Anual</option><option>Bianual</option><option>Perenne</option></select></label>
        <label>Germinaci√≥n m√≠n (d√≠as)<input type="number" min="0" name="gmin" value="5"/></label>
        <label>Germinaci√≥n m√°x (d√≠as)<input type="number" min="0" name="gmax" value="10"/></label>
        <label>Profundidad siembra<input name="depth" placeholder="mm/cm"/></label>
        <label>Distancia plantas<input name="spacing" placeholder="cm"/></label>
        <label>Riego<input name="watering" placeholder="bajo/medio/alto"/></label>
        <label>Ubicaci√≥n<input name="location" placeholder="invernadero, cantero A, etc."/></label>
        <label>Stock<input type="number" min="0" name="stock" value="0"/></label>
        <label>Periodo siembra<input name="periodo_siembra" placeholder="Ene-Feb, Sep-Nov"/></label>
        <label>Periodo trasplante<input name="periodo_trasplante" placeholder="Meses"/></label>
        <label>Interior<input type="checkbox" name="indoor" checked/></label>
        <label>Exterior<input type="checkbox" name="outdoor" checked/></label>
        <label class="full">Siembra<textarea name="sowing" rows="2" placeholder="C√≥mo sembrar‚Ä¶"></textarea></label>
        <label class="full">Notas<input name="notes" placeholder="separadas por coma"/></label>
        <label class="full">Etiquetas<input name="tags" placeholder="PIE, org√°nica, semilla propia"/></label>
        <label>Profesor responsable<input name="responsable" /></label>
        <label>Curso/Proyecto<input name="curso" /></label>
        <label class="full">Uso previsto<textarea name="uso" rows="2"></textarea></label>
      </div>
      <footer class="modal-actions hidden">
        <button class="btn ghost" value="cancel">Cancelar</button>
        <button class="btn grad-green" id="saveSeedBtn" value="default">Guardar</button>
      </footer>
      <p class="form-error hidden" id="formError">Revisa los campos obligatorios.</p>
    </form>
  </dialog>

  <footer class="footer">
    <small>¬© Banco de Semillas ‚Äî Liceo Bicentenario San Nicol√°s.</small>
  </footer>

  <script src="js/app_csv_v3.js"></script>
  <script defer src="js/guard_access.js"></script>
</body>
</html>
